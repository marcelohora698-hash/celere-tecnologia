<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Célere - Tecnologia em Saúde</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ... (todo o CSS anterior permanece igual) ... */

        /* ESTILOS ESPECÍFICOS PARA IMPRESSÃO DO TERMO */
        @media print {
            body {
                background: white !important;
                color: black !important;
                font-family: 'Arial', sans-serif !important;
                margin: 0;
                padding: 0;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
            
            .container {
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Timbrado oficial da Célere */
            .timbrado-celere {
                text-align: center;
                border-bottom: 3px solid #0f5132;
                padding: 20px 0;
                margin-bottom: 25px;
                background: white;
            }
            
            .timbrado-celere .logo {
                color: #0f5132;
                font-size: 32px;
                font-weight: bold;
                margin: 0;
                line-height: 1.2;
            }
            
            .timbrado-celere .subtitulo {
                color: #157347;
                font-size: 20px;
                margin: 5px 0 15px 0;
                font-weight: normal;
            }
            
            .timbrado-celere .empresa {
                font-size: 14px;
                color: #333;
                margin: 8px 0;
                font-weight: bold;
            }
            
            .timbrado-celere .cnpj {
                font-size: 12px;
                color: #666;
                margin: 5px 0;
            }
            
            .timbrado-celere .endereco {
                font-size: 12px;
                color: #666;
                margin: 5px 0;
            }
            
            .timbrado-celere .contato {
                font-size: 12px;
                color: #666;
                margin: 5px 0;
            }
            
            .timbrado-celere .site {
                font-size: 12px;
                color: #0f5132;
                font-weight: bold;
                margin: 8px 0 0 0;
            }
            
            /* Termo de entrega */
            .termo-impressao {
                padding: 15px 30px;
                background: white;
            }
            
            .termo-header {
                text-align: center;
                margin-bottom: 25px;
            }
            
            .termo-header h3 {
                color: #0f5132;
                font-size: 20px;
                margin-bottom: 8px;
                text-transform: uppercase;
            }
            
            .protocolo {
                background: #f8f9fa;
                padding: 12px;
                border: 2px solid #0f5132;
                margin-bottom: 20px;
                text-align: center;
                font-weight: bold;
                font-size: 16px;
            }
            
            .dados-entrega {
                margin-bottom: 20px;
                padding: 15px;
                border: 1px solid #ddd;
                background: #fafafa;
            }
            
            .dados-entrega .row {
                margin-bottom: 8px;
                display: flex;
            }
            
            .dados-entrega .col-md-6 {
                width: 50%;
                padding: 0 10px;
            }
            
            .tabela-equipamentos {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                font-size: 12px;
            }
            
            .tabela-equipamentos th {
                background: #0f5132;
                color: white;
                padding: 10px;
                text-align: left;
                border: 1px solid #ddd;
                font-weight: bold;
            }
            
            .tabela-equipamentos td {
                padding: 10px;
                border: 1px solid #ddd;
            }
            
            .termo-texto {
                margin: 20px 0;
                line-height: 1.5;
                font-size: 13px;
                text-align: justify;
            }
            
            .termo-texto strong {
                color: #0f5132;
            }
            
            .assinaturas {
                margin-top: 80px;
                page-break-inside: avoid;
            }
            
            .assinatura-area {
                width: 45%;
                display: inline-block;
                text-align: center;
                margin: 0 2%;
                vertical-align: top;
            }
            
            .linha-assinatura {
                border-top: 1px solid #000;
                margin-top: 60px;
                padding-top: 5px;
                width: 100%;
            }
            
            .nome-assinatura {
                font-weight: bold;
                margin-top: 5px;
            }
            
            .cargo-assinatura {
                font-size: 11px;
                color: #666;
            }
            
            .rodape-termo {
                margin-top: 30px;
                text-align: center;
                font-size: 10px;
                color: #666;
                border-top: 1px solid #ddd;
                padding-top: 10px;
            }
            
            /* Garantir que não quebre no meio das assinaturas */
            .pagina-inteira {
                page-break-inside: avoid;
            }
        }

        /* Visualização do termo antes da impressão */
        .preview-termo {
            background: white;
            color: black;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: none;
        }

        .btn-visualizar {
            margin-bottom: 20px;
        }

        /* Modal de visualização */
        .modal-preview .modal-content {
            background: white;
            color: black;
        }

        .modal-preview .modal-header {
            border-bottom: 2px solid #0f5132;
            background: #f8f9fa;
        }

        .modal-preview .modal-title {
            color: #0f5132;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Status de Sincronização -->
    <div id="syncStatus" class="sync-status" style="display: none;"></div>

    <!-- Header com Logo FIXO -->
    <div class="header-custom text-white">
        <div class="container">
            <div class="logo-area">
                <!-- LOGO FIXO - IMAGEM MAIOR E CENTRALIZADA -->
                <div class="logo-container-full">
                    <div class="logo-img-container">
                        <!-- Imagem com fundo transparente -->
                        <img src="./images/logo-celere.png" alt="Célere Tecnologia em Saúde" class="logo-img" 
                             onerror="this.style.display='none'; document.getElementById('logo-texto').style.display='block';">
                        <!-- Fallback de texto caso a imagem não carregue -->
                        <div id="logo-texto" style="display: none; text-align: center;">
                            <h1 style="font-size: 3rem; font-weight: bold; margin-bottom: 10px;">CÉLERE</h1>
                            <h2 style="font-size: 1.5rem; opacity: 0.9;">Tecnologia em Saúde</h2>
                        </div>
                    </div>
                </div>
                
                <!-- Ícones de Tecnologia em Saúde -->
                <div class="health-tech-icons">
                    <i class="fas fa-desktop tech-icon pulse" title="Tecnologia"></i>
                    <i class="fas fa-stethoscope tech-icon" title="Saúde"></i>
                    <i class="fas fa-laptop-medical tech-icon pulse" title="TI em Saúde"></i>
                </div>
                
                <h3 class="h5 mb-1">Sistema de Entrega de Equipamentos de TI</h3>
                <p class="small mb-0 opacity-85"><i class="fas fa-heartbeat me-1"></i> Tecnologia em Saúde</p>
            </div>
        </div>
    </div>

    <div class="container py-4">
        <!-- ... (todo o conteúdo anterior das abas permanece igual) ... -->

    <!-- Modal de Visualização do Termo -->
    <div class="modal fade modal-preview" id="modalPreview" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pré-visualização do Termo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="preview-content">
                        <!-- Conteúdo será preenchido via JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-custom" onclick="imprimirTermoCompleto()">
                        <i class="fas fa-print me-2"></i>Imprimir Termo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Área de Impressão (oculta na tela, visível apenas na impressão) -->
    <div id="area-impressao" style="display: none;">
        <div class="termo-impressao">
            <!-- Timbrado Oficial da Célere -->
            <div class="timbrado-celere">
                <div class="logo">CÉLERE</div>
                <div class="subtitulo">TECNOLOGIA EM SAÚDE</div>
                <div class="empresa">CÉLERE TECNOLOGIA E ASSESSORIA EM SAÚDE PÚBLICA E PRIVADA LTDA</div>
                <div class="cnpj">CNPJ: 46.961.423/0001-79</div>
                <div class="endereco">Rua Ziderita, 1166, Sala 03, Bairro Amador, Estebio – CE</div>
                <div class="contato">Contato – Tel: (85) 69206-4075. E-mail: comercial@celeretecnologia.com.br</div>
                <div class="site">WWW.CELERETECNOLOGIA.COM.BR</div>
            </div>

            <!-- Conteúdo do Termo -->
            <div class="termo-header">
                <h3>TERMO DE ENTREGA E RESPONSABILIDADE</h3>
                <div class="protocolo" id="impressao-protocolo">PROTOCOLO: PROT-2024-001</div>
            </div>

            <div class="dados-entrega">
                <div class="row">
                    <div class="col-md-6">
                        <strong>Colaborador:</strong> <span id="impressao-usuario">-</span>
                    </div>
                    <div class="col-md-6">
                        <strong>Matrícula:</strong> <span id="impressao-matricula">-</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <strong>Setor:</strong> <span id="impressao-setor">-</span>
                    </div>
                    <div class="col-md-6">
                        <strong>Técnico Responsável:</strong> <span id="impressao-tecnico">-</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <strong>Data da Entrega:</strong> <span id="impressao-data">-</span>
                    </div>
                    <div class="col-md-6">
                        <strong>Total de Equipamentos:</strong> <span id="impressao-total">0</span>
                    </div>
                </div>
            </div>

            <h5>EQUIPAMENTOS ENTREGUES</h5>
            <table class="tabela-equipamentos">
                <thead>
                    <tr>
                        <th>Equipamento</th>
                        <th>Quantidade</th>
                        <th>Observações</th>
                    </tr>
                </thead>
                <tbody id="impressao-equipamentos">
                    <!-- Preenchido via JavaScript -->
                </tbody>
            </table>

            <div class="termo-texto">
                <p>Eu, <strong id="impressao-usuario-assinatura">-</strong>, matrícula <strong id="impressao-matricula-assinatura">-</strong>, declaro que acompanhei a separação dos equipamentos, que foi conferido os números de tombamento de todos equipamentos e que confirma a quantidade entregue de equipamentos no geral.</p>
                
                <p>Comprometo-me a:</p>
                <ul>
                    <li>Utilizar os equipamentos exclusivamente para fins profissionais</li>
                    <li>Zelar pela conservação e segurança dos mesmos</li>
                    <li>Comunicar imediatamente qualquer problema técnico à equipe de TI</li>
                    <li>Devolver todos os equipamentos em caso de desligamento ou transferência</li>
                    <li>Responsabilizar-me por quaisquer danos causados por uso inadequado</li>
                </ul>
                
                <p>Declaro ainda que todos os equipamentos relacionados acima foram recebidos em perfeito estado de funcionamento.</p>
            </div>

            <div class="assinaturas pagina-inteira">
                <div class="assinatura-area">
                    <div class="linha-assinatura"></div>
                    <div class="nome-assinatura" id="impressao-assinatura-usuario">-</div>
                    <div class="cargo-assinatura">Colaborador</div>
                </div>
                
                <div class="assinatura-area">
                    <div class="linha-assinatura"></div>
                    <div class="nome-assinatura" id="impressao-assinatura-tecnico">-</div>
                    <div class="cargo-assinatura">Técnico Responsável</div>
                </div>
            </div>

            <div class="rodape-termo">
                <p>Documento gerado automaticamente pelo Sistema Célere - Tecnologia em Saúde</p>
                <p>Este termo possui validade legal e deve ser arquivado pelo setor responsável</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ... (todo o JavaScript anterior permanece igual) ...

        // ========== SISTEMA DE IMPRESSÃO MELHORADO ==========
        function visualizarTermo() {
            // Atualizar dados na área de impressão
            atualizarDadosImpressao();
            
            // Mostrar modal de pré-visualização
            const modal = new bootstrap.Modal(document.getElementById('modalPreview'));
            
            // Copiar conteúdo para o modal
            const areaImpressao = document.getElementById('area-impressao').innerHTML;
            document.getElementById('preview-content').innerHTML = areaImpressao;
            
            modal.show();
        }

        function atualizarDadosImpressao() {
            // Atualizar dados básicos
            document.getElementById('impressao-usuario').textContent = document.getElementById('usuario').value || '-';
            document.getElementById('impressao-matricula').textContent = document.getElementById('matricula').value || '-';
            document.getElementById('impressao-setor').textContent = document.getElementById('setor').value || '-';
            document.getElementById('impressao-tecnico').textContent = document.getElementById('tecnico').value || '-';
            
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            document.getElementById('impressao-data').textContent = dataAtual;
            
            // Gerar protocolo
            const protocolo = `PROT-${new Date().getFullYear()}-${String(entregas.length + 1).padStart(3, '0')}`;
            document.getElementById('impressao-protocolo').textContent = `PROTOCOLO: ${protocolo}`;
            
            // Atualizar equipamentos
            const tbody = document.getElementById('impressao-equipamentos');
            tbody.innerHTML = '';
            
            const equipamentos = [
                { nome: 'CPU', qtd: quantidades.cpu },
                { nome: 'Monitor', qtd: quantidades.monitor },
                { nome: 'Cabo de Energia Desktop', qtd: quantidades.caboEnergiaDesktop },
                { nome: 'Cabo de Energia Monitor', qtd: quantidades.caboEnergiaMonitor },
                { nome: 'Teclado', qtd: quantidades.teclado },
                { nome: 'Mouse', qtd: quantidades.mouse },
                { nome: 'Cabo HDMI', qtd: quantidades.caboHdmi },
                { nome: 'Cabo VGA', qtd: quantidades.caboVga }
            ];
            
            let totalEquipamentos = 0;
            equipamentos.forEach(equip => {
                if (equip.qtd > 0) {
                    totalEquipamentos += equip.qtd;
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${equip.nome}</td>
                        <td>${equip.qtd}</td>
                        <td>Conferido e em perfeito estado</td>
                    `;
                    tbody.appendChild(tr);
                }
            });
            
            document.getElementById('impressao-total').textContent = totalEquipamentos;
            
            // Atualizar assinaturas
            document.getElementById('impressao-usuario-assinatura').textContent = document.getElementById('usuario').value || '-';
            document.getElementById('impressao-matricula-assinatura').textContent = document.getElementById('matricula').value || '-';
            document.getElementById('impressao-assinatura-usuario').textContent = document.getElementById('usuario').value || '-';
            document.getElementById('impressao-assinatura-tecnico').textContent = document.getElementById('tecnico').value || '-';
        }

        function imprimirTermoCompleto() {
            // Primeiro salva a entrega
            const entrega = {
                id: Date.now(),
                protocolo: document.getElementById('impressao-protocolo').textContent.replace('PROTOCOLO: ', ''),
                tecnico: document.getElementById('tecnico').value,
                usuario: document.getElementById('usuario').value,
                matricula: document.getElementById('matricula').value,
                setor: document.getElementById('setor').value,
                data: new Date().toISOString(),
                equipamentos: { ...quantidades }
            };
            
            entregas.push(entrega);
            localStorage.setItem('celere_entregas', JSON.stringify(entregas));
            
            // Fecha o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalPreview'));
            modal.hide();
            
            // Aguarda um pouco antes de imprimir
            setTimeout(() => {
                // Atualiza os dados antes de imprimir
                atualizarDadosImpressao();
                
                // Aciona a impressão
                const areaImpressao = document.getElementById('area-impressao');
                const janelaImpressao = window.open('', '_blank');
                janelaImpressao.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Termo de Entrega - ${entrega.protocolo}</title>
                        <style>
                            ${obterEstilosImpressao()}
                        </style>
                    </head>
                    <body>
                        ${areaImpressao.innerHTML}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                    </html>
                `);
                janelaImpressao.document.close();
                
                mostrarStatus('Termo impresso com sucesso!', 'success');
                atualizarRelatorios();
            }, 500);
        }

        function obterEstilosImpressao() {
            return `
                /* ... (copiar todos os estilos @media print aqui) ... */
            `;
        }

        // Atualizar o botão de gerar termo para abrir a visualização
        document.getElementById('btn-gerar-termo').onclick = visualizarTermo;

        // ... (restante do JavaScript permanece igual) ...
    </script>
</body>
</html>
