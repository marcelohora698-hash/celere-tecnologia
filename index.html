<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Célere - Tecnologia em Saúde</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Adicionando html2pdf para exportação em PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --cor-primaria: #157347;
            --cor-secundaria: #0f5132;
            --cor-destaque: #198754;
            --verde-principal: #0f5132;
            --verde-secundario: #157347;
            --verde-escuro: #0a3622;
        }
        
        body {
            background: linear-gradient(135deg, var(--verde-principal) 0%, var(--verde-secundario) 100%) !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            color: white;
        }
        
        /* ... (mantenha todos os estilos existentes) ... */

        /* NOVOS ESTILOS PARA A ABA TERMO */
        .preview-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-height: 500px;
            overflow-y: auto;
        }

        .termo-preview {
            background: white;
            color: black;
            padding: 30px;
            border: 2px solid #0f5132;
            border-radius: 10px;
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
        }

        .termo-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #0f5132;
            padding-bottom: 20px;
        }

        .termo-content {
            margin-bottom: 30px;
        }

        .termo-signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
        }

        .signature-field {
            text-align: center;
            width: 45%;
        }

        .linha-assinatura {
            border-top: 2px solid #000;
            margin: 40px 0 10px 0;
            padding-top: 5px;
        }

        .acoes-termo {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .btn-group-termo {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Melhorias no modal de visualização */
        .modal-preview .modal-content {
            background: white;
            color: black;
        }

        .modal-preview .modal-header {
            border-bottom: 2px solid #0f5132;
            background: #f8f9fa;
        }

        .modal-preview .modal-title {
            color: #0f5132;
            font-weight: bold;
        }

        .modal-preview .modal-body {
            padding: 0;
            background: #f8f9fa;
        }

        #preview-content {
            transform: scale(0.85);
            transform-origin: top center;
            width: 117.65%;
            margin-left: -8.825%;
            padding: 20px 0;
        }

        /* Ajustes responsivos */
        @media (max-width: 768px) {
            .termo-signatures {
                flex-direction: column;
                gap: 30px;
            }
            
            .signature-field {
                width: 100%;
            }

            .btn-group-termo {
                flex-direction: column;
                align-items: center;
            }

            .btn-group-termo .btn {
                width: 100%;
                max-width: 300px;
                margin-bottom: 10px;
            }
        }

        /* ... (mantenha todos os outros estilos existentes) ... */

    </style>
</head>
<body>
    <!-- Status de Sincronização -->
    <div id="syncStatus" class="sync-status" style="display: none;"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Carregando...</span>
        </div>
    </div>

    <!-- Header com Logo FIXO -->
    <div class="header-custom text-white">
        <div class="container">
            <div class="logo-area">
                <!-- LOGO FIXO - IMAGEM E TEXTO LADO A LADO -->
                <div class="logo-container-full">
                    <div class="logo-img-container">
                        <!-- NOVA ESTRUTURA COM IMAGEM E TEXTO -->
                        <div class="logo-completa">
                            <!-- IMAGEM DO LOGO -->
                            <img src="images/celere.jpeg" alt="Logo Célere - Tecnologia em Saúde" class="logo-imagem">
                            
                            <!-- TEXTO DO LOGO -->
                            <div class="logo-texto">
                                <h1>CÉLERE</h1>
                                <h2>Tecnologia em Saúde</h2>
                                <p>Sistema de Entrega de Equipamentos de TI</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ícones de Tecnologia em Saúde -->
                <div class="health-tech-icons">
                    <i class="fas fa-desktop tech-icon pulse" title="Tecnologia"></i>
                    <i class="fas fa-stethoscope tech-icon" title="Saúde"></i>
                    <i class="fas fa-laptop-medical tech-icon pulse" title="TI em Saúde"></i>
                </div>
                
                <h3 class="h5 mb-1">logistica e sistema de informatização em saúde</h3>
                <p class="small mb-0 opacity-85"><i class="fas fa-heartbeat me-1"></i> Tecnologia em Saúde</p>
            </div>
        </div>
    </div>

    <div class="container py-4">
        <!-- Card Estatísticas -->
        <div class="stats-card no-print fade-in">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4><i class="fas fa-laptop-medical me-2"></i>Entrega de equipamentos</h4>
                    <p class="mb-2" id="progresso-texto">Total de equipamentos entregues: 0</p>
                    <div class="progress">
                        <div id="progresso-bar" class="progress-bar bg-success" style="width: 0%"></div>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-outline-light" onclick="proximaAba('relatorios')" data-bs-toggle="tooltip" data-bs-title="Visualizar relatórios e estatísticas">
                        <i class="fas fa-chart-bar me-1"></i>Relatórios
                    </button>
                </div>
            </div>
        </div>

        <!-- Abas -->
        <ul class="nav nav-tabs mb-4 no-print" id="myTab">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#dados">
                    <i class="fas fa-user me-2"></i>Dados
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#equipamentos">
                    <i class="fas fa-laptop me-2"></i>Equipamentos
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#quantidades">
                    <i class="fas fa-calculator me-2"></i>Quantidades
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#termo">
                    <i class="fas fa-file-signature me-2"></i>Termo
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#relatorios">
                    <i class="fas fa-chart-bar me-2"></i>Relatórios
                </a>
            </li>
        </ul>

        <div class="tab-content">
            <!-- ... (mantenha as abas Dados, Equipamentos, Quantidades e Relatórios existentes) ... -->

            <!-- Termo - ABA CORRIGIDA -->
            <div class="tab-pane fade" id="termo">
                <div class="card fade-in">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-file-signature me-2"></i>Termo de Entrega e Responsabilidade</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Revise as informações antes de gerar o termo</strong>
                        </div>

                        <div class="mb-4">
                            <h6>Resumo da Entrega</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Colaborador:</strong> <span id="termo-usuario">-</span></p>
                                    <p><strong>Matrícula:</strong> <span id="termo-matricula">-</span></p>
                                    <p><strong>Setor:</strong> <span id="termo-setor">-</span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Técnico Responsável:</strong> <span id="termo-tecnico">-</span></p>
                                    <p><strong>Data da Entrega:</strong> <span id="termo-data">-</span></p>
                                    <p><strong>Protocolo:</strong> <span id="termo-protocolo">-</span></p>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <h6>Equipamentos Entregues</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Equipamento</th>
                                            <th class="text-center">Quantidade</th>
                                        </tr>
                                    </thead>
                                    <tbody id="termo-equipamentos">
                                        <!-- Equipamentos serão preenchidos via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- NOVA SEÇÃO: VISUALIZAÇÃO DO TERMO -->
                        <div class="mb-4">
                            <h6>Visualização do Termo</h6>
                            <div class="preview-container">
                                <div class="termo-preview" id="termo-preview">
                                    <!-- Conteúdo do termo será gerado aqui -->
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <h6>Termo de Responsabilidade</h6>
                            <div class="p-3 bg-verde-pagina rounded">
                                <p class="mb-3">Eu, <strong><span id="termo-usuario-assinatura">-</span></strong>, matrícula <strong><span id="termo-matricula-assinatura">-</span></strong>, declaro que realizei check list em todos equipamentos e acompanhei a separação de todos equipamentos que foram entregues no ato.</p>
                                
                                <p class="mb-3">Declaro que:</p>
                                <ul>
                                    <li>Declaro que todos os números de tombamentos dos equipamentos foram conferidos no ato dessa entrega</li>
                                    <li>Comunicar imediatamente qualquer problema técnico à equipe de TI</li>
                                    <li>Responsabilizar-me por quaisquer danos causados por uso inadequado</li>
                                </ul>
                                
                                <p class="mb-0">Declaro ainda que todos os equipamentos relacionados acima foram recebidos em perfeito estado de funcionamento.</p>
                            </div>
                        </div>

                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="aceite-termo">
                            <label class="form-check-label">
                                Confirmo que todas as informações estão corretas e concordo com os termos acima
                            </label>
                        </div>

                        <!-- NOVA SEÇÃO: AÇÕES DO TERMO -->
                        <div class="acoes-termo">
                            <div class="btn-group-termo">
                                <button class="btn btn-custom btn-lg" id="btn-gerar-termo" onclick="visualizarTermoModal()" disabled>
                                    <i class="fas fa-eye me-2"></i>Visualizar Termo Completo
                                </button>
                                <button class="btn btn-success btn-lg" id="btn-salvar-pdf" onclick="salvarComoPDF()" disabled>
                                    <i class="fas fa-file-pdf me-2"></i>Salvar como PDF
                                </button>
                                <button class="btn btn-primary btn-lg" id="btn-imprimir-termo" onclick="imprimirTermoDireto()" disabled>
                                    <i class="fas fa-print me-2"></i>Imprimir Termo
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex justify-content-between">
                        <button class="btn btn-secondary" onclick="proximaAba('quantidades')">
                            <i class="fas fa-arrow-left me-2"></i>Voltar
                        </button>
                        <button class="btn btn-outline-light" onclick="atualizarVisualizacaoTermo()">
                            <i class="fas fa-sync me-2"></i>Atualizar Visualização
                        </button>
                    </div>
                </div>
            </div>

            <!-- ... (mantenha a aba Relatórios existente) ... -->
        </div>
    </div>

    <!-- Modal de Visualização do Termo -->
    <div class="modal fade modal-preview" id="modalPreview" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pré-visualização do Termo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="preview-content">
                        <!-- Conteúdo será preenchido via JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-custom" onclick="imprimirTermoCompleto()">
                        <i class="fas fa-print me-2"></i>Imprimir Termo
                    </button>
                    <button type="button" class="btn btn-success" onclick="salvarComoPDFModal()">
                        <i class="fas fa-file-pdf me-2"></i>Salvar como PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== NOVAS FUNÇÕES PARA A ABA TERMO ==========

        // Função para atualizar a visualização do termo na aba
        function atualizarVisualizacaoTermo() {
            if (!validarDadosParaTermo()) {
                mostrarStatus('Preencha todos os dados obrigatórios!', 'error');
                return;
            }

            const termoPreview = document.getElementById('termo-preview');
            if (termoPreview) {
                termoPreview.innerHTML = gerarConteudoTermoSimples();
            }

            // Habilitar/desabilitar botões baseado na validação
            const aceite = document.getElementById('aceite-termo').checked;
            const camposValidos = validarCamposObrigatorios();
            const temEquipamentos = Object.values(quantidades).some(qtd => qtd > 0);
            
            const btnGerar = document.getElementById('btn-gerar-termo');
            const btnPDF = document.getElementById('btn-salvar-pdf');
            const btnImprimir = document.getElementById('btn-imprimir-termo');
            
            const habilitar = aceite && camposValidos && temEquipamentos;
            
            if (btnGerar) btnGerar.disabled = !habilitar;
            if (btnPDF) btnPDF.disabled = !habilitar;
            if (btnImprimir) btnImprimir.disabled = !habilitar;

            mostrarStatus('Visualização do termo atualizada!', 'success');
        }

        // Função para gerar conteúdo simples do termo (para preview na aba)
        function gerarConteudoTermoSimples() {
            const usuario = document.getElementById('usuario').value || '-';
            const matricula = document.getElementById('matricula').value || '-';
            const setor = document.getElementById('setor').value || '-';
            const tecnico = document.getElementById('tecnico').value || '-';
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            const protocolo = `PROT-${new Date().getFullYear()}-${String(entregas.length + 1).padStart(3, '0')}`;

            // Gerar lista de equipamentos
            let equipamentosHTML = '';
            const equipamentos = [
                { nome: 'Desktop', qtd: quantidades.desktop },
                { nome: 'Monitor', qtd: quantidades.monitor },
                { nome: 'Cabo de Energia Desktop', qtd: quantidades.caboEnergiaDesktop },
                { nome: 'Cabo de Energia Monitor', qtd: quantidades.caboEnergiaMonitor },
                { nome: 'Teclado', qtd: quantidades.teclado },
                { nome: 'Mouse', qtd: quantidades.mouse },
                { nome: 'Cabo HDMI', qtd: quantidades.caboHdmi },
                { nome: 'Cabo VGA', qtd: quantidades.caboVga }
            ];

            equipamentos.forEach(equip => {
                if (equip.qtd > 0) {
                    equipamentosHTML += `
                        <tr>
                            <td>${equip.nome}</td>
                            <td class="text-center">${equip.qtd}</td>
                        </tr>
                    `;
                }
            });

            return `
                <div class="termo-header">
                    <h3 style="color: #0f5132;">CÉLERE TECNOLOGIA EM SAÚDE</h3>
                    <h4>TERMO DE ENTREGA E RESPONSABILIDADE</h4>
                    <div class="protocolo-termo" style="background: #0f5132; color: white; padding: 8px 20px; border-radius: 20px; display: inline-block;">
                        PROTOCOLO: ${protocolo}
                    </div>
                </div>

                <div class="termo-content">
                    <p><strong>Colaborador:</strong> ${usuario}</p>
                    <p><strong>Matrícula:</strong> ${matricula}</p>
                    <p><strong>Setor:</strong> ${setor}</p>
                    <p><strong>Técnico Responsável:</strong> ${tecnico}</p>
                    <p><strong>Data da Entrega:</strong> ${dataAtual}</p>

                    <h5 style="color: #0f5132; margin-top: 20px;">EQUIPAMENTOS ENTREGUES</h5>
                    <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                        <thead>
                            <tr style="background: #0f5132; color: white;">
                                <th style="padding: 10px; text-align: left;">Equipamento</th>
                                <th style="padding: 10px; text-align: center;">Quantidade</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${equipamentosHTML}
                        </tbody>
                    </table>

                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-left: 4px solid #0f5132;">
                        <p>Eu, <strong>${usuario}</strong>, matrícula <strong>${matricula}</strong>, declaro que realizei check list em todos equipamentos e acompanhei a separação de todos equipamentos que foram entregues no ato.</p>
                        
                        <p><strong>Declaro que:</strong></p>
                        <ul>
                            <li>Declaro que todos os números de tombamentos dos equipamentos foram conferidos no ato dessa entrega</li>
                            <li>Comunicar imediatamente qualquer problema técnico à equipe de TI</li>
                            <li>Responsabilizar-me por quaisquer danos causados por uso inadequado</li>
                        </ul>
                        
                        <p>Declaro ainda que todos os equipamentos relacionados acima foram recebidos em perfeito estado de funcionamento.</p>
                    </div>
                </div>

                <div class="termo-signatures">
                    <div class="signature-field">
                        <div class="linha-assinatura"></div>
                        <div class="nome-assinatura">${usuario}</div>
                        <div class="cargo-assinatura">Colaborador</div>
                    </div>
                    
                    <div class="signature-field">
                        <div class="linha-assinatura"></div>
                        <div class="nome-assinatura">${tecnico}</div>
                        <div class="cargo-assinatura">Técnico Responsável</div>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center; font-size: 11px; color: #666; border-top: 1px solid #ccc; padding-top: 10px;">
                    <p>Documento gerado automaticamente pelo Sistema Célere - Tecnologia em Saúde</p>
                </div>
            `;
        }

        // Função para visualizar o termo no modal
        function visualizarTermoModal() {
            if (!validarDadosParaTermo()) {
                mostrarStatus('Preencha todos os dados obrigatórios!', 'error');
                return;
            }

            const previewContent = document.getElementById('preview-content');
            if (previewContent) {
                previewContent.innerHTML = gerarConteudoImpressao();
            }

            const modalElement = document.getElementById('modalPreview');
            if (modalElement) {
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
            }
        }

        // Função para salvar como PDF a partir da aba termo
        function salvarComoPDF() {
            if (!validarDadosParaTermo()) {
                mostrarStatus('Preencha todos os dados obrigatórios!', 'error');
                return;
            }

            mostrarLoading(true);

            const element = document.getElementById('termo-preview');
            if (!element) {
                mostrarLoading(false);
                mostrarStatus('Erro ao gerar PDF!', 'error');
                return;
            }

            const options = {
                margin: 10,
                filename: `termo-entrega-${document.getElementById('usuario').value}-${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(options).from(element).save().then(() => {
                mostrarLoading(false);
                mostrarStatus('PDF salvo com sucesso!', 'success');
            }).catch(error => {
                mostrarLoading(false);
                mostrarStatus('Erro ao salvar PDF: ' + error.message, 'error');
                console.error('Erro ao gerar PDF:', error);
            });
        }

        // Função para salvar como PDF a partir do modal
        function salvarComoPDFModal() {
            mostrarLoading(true);

            const element = document.getElementById('preview-content');
            if (!element) {
                mostrarLoading(false);
                mostrarStatus('Erro ao gerar PDF!', 'error');
                return;
            }

            const options = {
                margin: 10,
                filename: `termo-entrega-${document.getElementById('usuario').value}-${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(options).from(element).save().then(() => {
                mostrarLoading(false);
                mostrarStatus('PDF salvo com sucesso!', 'success');
                
                // Fechar modal após salvar
                const modalElement = document.getElementById('modalPreview');
                if (modalElement) {
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                }
            }).catch(error => {
                mostrarLoading(false);
                mostrarStatus('Erro ao salvar PDF: ' + error.message, 'error');
                console.error('Erro ao gerar PDF:', error);
            });
        }

        // Função para impressão direta da aba termo
        function imprimirTermoDireto() {
            if (!validarDadosParaTermo()) {
                mostrarStatus('Preencha todos os dados obrigatórios!', 'error');
                return;
            }

            mostrarLoading(true);

            // Criar um iframe para impressão
            const iframe = document.createElement('iframe');
            iframe.style.position = 'fixed';
            iframe.style.right = '0';
            iframe.style.bottom = '0';
            iframe.style.width = '0';
            iframe.style.height = '0';
            iframe.style.border = 'none';
            
            document.body.appendChild(iframe);
            
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            iframeDoc.open();
            iframeDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Termo de Entrega</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px;
                            color: #000;
                        }
                        .termo-header { text-align: center; margin-bottom: 30px; }
                        .protocolo-termo { 
                            background: #0f5132; 
                            color: white; 
                            padding: 8px 20px; 
                            border-radius: 20px; 
                            display: inline-block; 
                            margin: 10px 0;
                        }
                        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                        th { background: #0f5132; color: white; padding: 10px; text-align: left; }
                        td { padding: 8px; border: 1px solid #ddd; }
                        .assinaturas { display: flex; justify-content: space-between; margin-top: 60px; }
                        .assinatura { text-align: center; width: 45%; }
                        .linha-assinatura { border-top: 2px solid #000; margin: 40px 0 10px 0; }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    ${gerarConteudoTermoSimples()}
                </body>
                </html>
            `);
            iframeDoc.close();
            
            // Configurar evento para quando a impressão terminar
            iframe.contentWindow.onfocus = function() {
                setTimeout(() => {
                    document.body.removeChild(iframe);
                    mostrarLoading(false);
                    mostrarStatus('Termo impresso com sucesso!', 'success');
                }, 1000);
            };
            
            // Forçar impressão
            setTimeout(() => {
                iframe.contentWindow.print();
            }, 500);
        }

        // ========== MODIFICAÇÕES NAS FUNÇÕES EXISTENTES ==========

        // Modificar a função atualizarTermo para incluir a atualização da visualização
        function atualizarTermo() {
            // ... (código existente da função atualizarTermo) ...

            // ADICIONAR NO FINAL DA FUNÇÃO:
            setTimeout(atualizarVisualizacaoTermo, 100);
        }

        // Modificar a função validarDadosParaTermo para ser mais robusta
        function validarDadosParaTermo() {
            const camposObrigatorios = ['tecnico', 'usuario', 'matricula', 'setor'];
            
            for (let campo of camposObrigatorios) {
                const element = document.getElementById(campo);
                if (!element || !element.value.trim()) {
                    return false;
                }
            }
            
            const temEquipamentos = Object.values(quantidades).some(qtd => qtd > 0);
            if (!temEquipamentos) {
                return false;
            }
            
            const aceite = document.getElementById('aceite-termo').checked;
            if (!aceite) {
                return false;
            }
            
            return true;
        }

        // ========== INICIALIZAÇÃO ATUALIZADA ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Sistema Célere inicializado!');
            inicializarSistema();
            inicializarTooltips();
            
            // NOVO: Inicializar a visualização do termo
            setTimeout(atualizarVisualizacaoTermo, 500);
        });

        // ... (mantenha todas as outras funções existentes) ...
    </script>
</body>
</html>
